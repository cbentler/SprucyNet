<!--SprucyNet v0.0.4 9-10-16-->

<HTML>

  <head>
    <title>SprucyNet Admin Page</title>
    <link rel="icon" href="resources/favicon.png">
<style>
	#banner{
	background-color: #3b5998;
	min-height: 90px;
	max-height: 100px;
	width: 100%;
	}

  .panel input{
    border: none;
    background-color: #cdd3e5;
    padding: 4px;
    border-radius: 5px;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
  }

  .panel select{
    border: none;
    background-color: #cdd3e5;
    padding: 4px;
    border-radius: 5px;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    width: 220px;
  }

  .panel textarea{
    border: none;
    background-color: #cdd3e5;
    border-radius: 5px;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    width: 100%;
  }

  body {
  font-family: "Lato", sans-serif;
  margin: 0px;

  }

  ul.tab {
    list-style-type: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    border: 1px solid #ccc;
    background-color: #3b5998;
  }

  /* Float the list items side by side */
  ul.tab li {
	  float: left;
	  width: 33.333%;
    line-height: 51px;
  }

  /* Style the links inside the list items */
  ul.tab li a {
    display: inline-block;
    color: white;
    text-align: center;
	  vertical-align: center;
    text-decoration: none;
    transition: 0.3s;
    font-size: 20px;
	  width: 100%;
  }


  /* Change background color of links on hover */
  ul.tab li a:hover {
    background-color: #687fb1;
  }

  /* Create an active/current tablink class */
  ul.tab li a:focus, .active {
    background-color: #687fb1;
  }

  /* Style the tab content */
  .tabcontent {
    display: none;
    padding: 12px;
    border: 1px solid #ccc;
    border-top: none;
	  background: #cdd3e5;
    min-height: 1000px;
  }

  table {
    width: 100%;
    border-collapse: collapse;

  }

  .usertable th {
    background-color: #3b5998;
    color: white;
  }

  .usertable tr:nth-child(even) {
    background-color: #f2f2f2 !important
  }

  .usertable tr:nth-child(odd){
    background-color: #DFE3EE;
  }

  .usertable td {
    text-align: center;
  }

  .billtable td{
    padding:18px;
    vertical-align: top;
    width: 50%;
  }

  .accContent td{
    padding: 0px;
  }

  .editBtn{
    background-color: #3b5998;
    height: 30px;
    width: 30px;
    border-radius: 5px;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    text-align: center;
  }

  .userbtn{
    padding: 8px;
    background-color: #3b5998;
    border: none;
    text-align: center;
    color: #FFF;
    font-size: 12pt;
    border-radius: 5px;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    opacity: 0.6;
  }

  .userbtn:hover, .userbtn.active{
    opacity: 1;
  }

  .userinput{
    display: none;
  }

  .userinput.show{
    display: block;
  }

  .addbtn{
    width: 60px;
    height: 40px;
    background-color: #3b5998;
    text-align: center;
    color: #FFF;
    font-size: 25pt;
    border-radius: 5px;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;

  }


  /* Style the buttons that are used to open and close the accordion panel */
div.accordion {
    background-color: #f2f2f2;
    color: #000;
    cursor: pointer;
    padding: 12px;
    height: 18px;
    width: 100%;
    text-align: left;
    border: none;
    outline: none;

}

/* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) 687fb1 */
div.accordion.active, div.accordion:hover {
    background-color: #3b5998;
    /*border-left: 6px solid #3b5998;*/
    color: #fff;

}

/* Style the accordion panel. Note: hidden by default */
div.panel {
  background-color: #f2f2f2;
  padding: 12px;
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  width: 100%;
}

/* The "show" class is added to the accordion panel when the user clicks on one of the buttons. This will show the panel content */
div.panel.show {
    display: block;
    opacity: 1;
    max-height: 500px;
}

.modal{
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgb(0,0,0);
  background-color: rgba(0,0,0,0.4);
}

.popContent{
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  width: 80%;
}

.popCancel{
  width: 60px;
  height: 40px;
  background-color: #FF0010;
  text-align: center;
  color: #FFF;
  font-size: 22pt;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
}

  .popSubmit{
    width: 60px;
    height: 40px;
    background-color: #00e600;
    text-align: center;
    color: #FFF;
    font-size: 22pt;
    border-radius: 5px;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
}

  .userCreationLink{
    padding: 8px;
    background-color: #3b5998;
    text-align: center;
    color: #FFF;
    font-size: 12pt;
    border-radius: 5px;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
  }

  </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script>
    var billto = 1;


    function onLoad(){
      getUserTable();
      getUserDS();
      getUserGrpDS();
      getCats();
      $('#tab1').css("display", "block");
      $('#defaultTab').addClass(" active");
      $('#amt').blur(function(){
        formatCurrency(this.id, $('#amt').val());
      });
      $('#payamt').blur(function(){
        formatCurrency(this.id, $('#payamt').val());
      })
    };

//gets user table data from db file
    function getUserTable(){
      var req = new XMLHttpRequest();
      req.onload = function(){
        var HTMLText = '<tr><th>User Num</th><th>User Name</th><th>Email</th><th>First Name</th><th>Edit User</th></tr>';
        HTMLText += this.responseText;
        $('#usertable').html(HTMLText);
      };
      req.open("get", "user.php", true);
      req.send();
    };

//gets user data from database file
    function getUserDS(){
      $.ajax({url: 'database.php',
        data: {action: "user"},
        type: 'POST',
        dataType:'text',
        error:function(error){console.log(error.responseText);},
        success: function(action){
          var HTMLText = '';
          HTMLText += action;
          $("[name='userinput']").html(HTMLText);
          $("[name='payuserinput']").html(HTMLText);
        }
        });
      };

//gets category data from db file
function getCats(){
  $.ajax({url: 'database.php',
    data: {action: "cat"},
    type: 'POST',
    dataType:'text',
    error:function(error){console.log(error.responseText);},
    success: function(action){
      var HTMLText = '';
      HTMLText += action;
      $("[name='catInput']").html(HTMLText);
    }
    });
  };

//Gets usergrp dataset from database file
    function getUserGrpDS(){
      $.ajax({url: 'database.php',
        data: {'action': 'userGrp'},
        type: 'POST',
        dataType:'text',
        success: function(data){
          var HTMLText = '';
          HTMLText += data;
          $("[name='usergrpinput']").html(HTMLText);
        },
        error:function(error){console.log(error.responseText);}
      });
    };

//Swtich between tabs
		function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
	  }

//expands the add bill or add payment sections of the bill/pay admin section
    function buttonClick(addID){
      var acc = document.getElementsByClassName("accordion");
      var i;
      document.getElementById(addID).classList.toggle("active");
      document.getElementById(addID).nextElementSibling.classList.toggle("show");
      for (i = 0; i < acc.length; i++) {
        if(acc[i].id != addID){
          acc[i].classList.remove("active");
          acc[i].nextElementSibling.classList.remove("show");
        }
      }
      defaultBillUser(addID);
      billto = 1;
    };

//sets default option to the Bill User button
    function defaultBillUser(addID){
      if(addID == 'addBill'){
        var inputCL = document.getElementById("usrSelect").className.split(/\s+/);
        var activeVar = 0;
        for(i = 0; i < inputCL.length; i++){
          if(inputCL[i] === "active"){
            activeVar = 1;
          }
        }
        if(activeVar != 1){
            document.getElementById("usrSelect").classList.add("active");
            document.getElementById("userinput").classList.add("show");
            $('#userlabel').html("User:");
            document.getElementById("grpSelect").classList.remove("active");
            document.getElementById("usergrpinput").classList.remove("show");
        }
      }
    }

//click function for the bill user and bill user group buttons
    function billBtnClick(btnID, inputID){
      var activeBtn = document.getElementById(btnID).className.split(/\s+/);
      var activeVar;
      for(i = 0; i < activeBtn.length; i++){
        if(activeBtn[i] === "active"){
          activeVar = 1;
        }
      }
      if(activeVar != 1){
          var acc = document.getElementsByClassName("userbtn");
          var inpt = document.getElementsByClassName("userinput");
          var inputiden = inputID+"input"
          var i;
          document.getElementById(btnID).classList.toggle("active");
          document.getElementById(inputiden).classList.toggle("show");

          for (i = 0; i < acc.length; i++) {
            if(acc[i].id != btnID){
              acc[i].classList.remove("active");
            }
          }

          for (i = 0; i < inpt.length; i++) {
            if(inpt[i].id != inputiden){
              inpt[i].classList.remove("show");
            }
          }

          if (inputID == 'user'){
            $('#userlabel').html("User:");
            billto = 1;
          }else{
            $('#userlabel').html("User Group:");
            billto = 2;
          }
        }
      }

//brings up confirmation dialouge
      function confirm(billorPay){

        var popBill = '';
        var popPay = '';
        if(billorPay == 'billAddBtn'){
          //bill add
          var cat = $('#catInput').val();
          var amt = $('#amt').val();
          var note = $('#notes').val();
            if(billto == 1){
              //user pay
              var user = $('#userinput').val();
              if(amt == '' || user == 'default'){
                alert('Please enter a user and/or amount.');
              }else{
              popBill = 'Are you sure you would like to submit a bill to <b>'+user+'</b> for the amount of <b>$'+amt+'</b>?<br><br>The following notes will also be recorded:<br><b>'+note+'</b><br>';
              $('#popText').html(popBill);
              $('#modal').css("display", "block");
              }
            }else if(billto == 2){
              //user group pay
              var usergrp = $('#usergrpinput').val();
              if(amt == '' || usergrp == 'default'){
                alert('Please enter a usergroup and/or amount.');
              }else{
              popBill = 'Are you sure you would like to submit a bill to the <b>'+usergrp+'</b> group for the amount of <b>$'+amt+'</b>?<br><br>The following notes will also be recorded:<br><b>'+note+'</b><br>';
              $('#popText').html(popBill);
              $('#modal').css("display", "block");
              }
            }else{
              console.log("Error! billto is not what you expect it to be.")
            }
          }else if(billorPay == 'payAddBtn'){
            //pay add
            var user = $('#payuserinput').val();
            var amt = $('#payamt').val();
            var note = $('#paynotes').val();
            if(amt == '' || user == 'default'){
              alert('Please enter a user and/or amount.');
            }else{
            popPay = 'Are you sure you would like to record a payment for <b>'+user+'</b> for the amount of <b>$'+amt+'</b>?<br><br>The following notes will also be recorded<br><b>'+note+'</b><br>';
            $('#popText').html(popPay);
            $('#modal').css("display", "block");
            }
          }else {
            console.log("Error! billorPay is empty.")
          }

        }

      function popExit(){
        $('#modal').css("display", "none");
      }

      window.onclick = function(event){
        if (event.target == modal){
          $('#modal').css("display", "none");
        }
      }

      function formatCurrency(id, val){
        alert(val+' '+id);
        var regex = /^\d+(?:\.\d{0,2})$/;
        if(regex.test(val)){
          alert('good');
          $('#'+id).css("background-color","#cdd3e5");
        }else{
          $('#'+id).css("background-color","#FF0000");
          alert('#'+id);
        }
        if(id == 'amt'){

        }else if(id == 'payamt'){

        }else{
          console.log('No ID field on blur.');
        }
      }


    </script>
  </head>
  <body onload="onLoad()">
  <form>
	<div id="banner">
		<a href="home.html">
		<img src="resources/sprucy.png" alt="sprucy">
		</a>
	</div>
	<br>
	<br>
	<div id="content">

		<ul class="tab">
			<li><a href="#" id="defaultTab" class="tablinks" onclick="openTab(event, 'tab1')">Bill/Pay</a></li>
			<li><a href="#" class="tablinks" onclick="openTab(event, 'tab2')">Users</a></li>
			<li><a href="#" class="tablinks" onclick="openTab(event, 'tab3')">User Groups</a></li>
		</ul>
		<div id="tab1" class="tabcontent">
        <br>
        <table class="billtable">
        <tr>
        <td>
        <div class="accordion" id="addBill" onclick="buttonClick(this.id)">Add Bill</div>
        <div class="panel">
          <table class="accContent">
            <tr>
              <td>
              </td>
              <td id="userlabel">
                User:
              </td>
            </tr>
            <tr>
              <td>
                <button name="usrSelect" id="usrSelect" value="Bill User" class="userbtn" type="button" onclick="billBtnClick(this.id, 'user')">Bill User</button>
                <button name="grpSelect" id="grpSelect" value="Bill User Group" class="userbtn" type="button" onclick="billBtnClick(this.id,'usergrp')">Bill User Group</button>
              </td>
              <td>
                <select name="userinput" id="userinput" class="userinput" >
                </select>
                <select name="usergrpinput" id="usergrpinput" class="userinput" >
                </select>
              </td>
            </tr>
            <tr>
              <td colspan="2" style="height: 15px;">
              </td>
            </tr>
            <tr>
              <td>
                Category:
              </td>
              <td>
                Amount:
              </td>
            </tr>
            <tr>
              <td>
                <select name="catInput" id="catInput">
                </select>
              </td>
              <td>
                <input type ="text" name="amt" id="amt"/>
              </td>
            </tr>
            <tr>
              <td colspan="2" style="height: 15px;">
              </td>
            </tr>
            <tr>
              <td colspan="2">
                Notes:
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <textarea name="notes" rows="3" id="notes"></textarea>
              </td>
            </tr>
            <tr>
              <td colspan="2" style="height: 15px;">
              </td>
            </tr>
            <tr>
              <td colspan="2" style="text-align: right;">
                <button type="button" id="billAddBtn" class="addbtn" onclick="confirm(this.id)">+</button>
              </td>
            </tr>
          </table>
          <br>
        </div>
      </td>
      <td>
        <div class="accordion" id="addPay" onclick="buttonClick(this.id)">Add Payment</div>
        <div class="panel">
          <table class="accContent">
            <tr>
              <td>
                User:
              </td>
              <td>
                Amount:
              </td>
            </tr>
            <tr>
              <td>
                <select name="payuserinput" id="payuserinput">
                </select>
              </td>
              <td>
                <input type ="text" name="payamt" id="payamt"/>
              </td>
            </tr>
            <tr>
              <td colspan="2" style="height: 15px;">
              </td>
            </tr>
            <tr>
              <td colspan="2">
                Notes:
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <textarea name="paynotes" rows="3" id="paynotes"></textarea>
              </td>
            </tr>
            <tr>
              <td colspan="2" style="height: 15px;">
              </td>
            </tr>
            <tr>
              <td colspan="2" style="text-align: right;">
                <button type="button" id="payAddBtn" class="addbtn" onclick="confirm(this.id)">+</button>
              </td>
            </tr>
          </table>
          </td>
          </tr>
        </table>
        </div>
        <div id="modal" class="modal">
            <div id="popContent" class="popContent">
              <div id="popText">
              </div>
              <div style="text-align: right;">
                <button type="button" class="popCancel" id="popCancel" onclick="popExit();">x</button>
                <button type="submit" class="popSubmit" id="popSubmit">+</button>
              </div>
            </div>
        </div>
		</div>
		<div id="tab2" class="tabcontent">
      <br>
      <table class="usertable" id="usertable" name="usertable">
      </table>
      <br>
      <div style="text-align: right;">
        <input id="newUser" name="newUser" class="userCreationLink" type="button" value="Create New User" onclick="location.href='UserCreation.html'" />
      </div>
		</div>
		<div id="tab3" class="tabcontent">
			<p>User Groups</p>
		</div>
	</div>
  </form>
  </body>
</HTML>
